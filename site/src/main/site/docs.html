<!doctype html>
<html>
#include( "src/main/site/head.tpl" )
<body>
	<div class="wrapper">
		#include( "src/main/site/header.tpl" )
		<section>
			<h3>Pragmatach Documentation</h3>
			<h4>Plugins</h4>
			<p>The Pragmatch framework does not include useful functionality by itself; all functionality is provided via plugins. The current plugins are:</p>
			<ul>
				<li>pragmatach-framework; this is the core Pragmatach code</li>
				<li>pragmatach-freemarker; support for the Freemarker template engine</li>
				<li>pragmatach-thymeleaf; support for the Thymeleaf template engine</li>
				<li>pragmatach-velocity; support for the Velocity template engine</li>
				<li>pragmatach-adminapp; the Pragmatach admin console</li>
				<li>pragmatach-gson; support for Google Gson</li>
				<li>pragmatach-json; support for JSON, including posting JSON to controllers</li>
				<li>pragmatach-xtream; XML support via XStream</li>
				<li>pragmatach-jcr; support for the JCR</li>
				<li>pragmatach-responsive; support for responsive design</li>
				<li>pragmatach-i8n; simple file-based i8n provider</li>
			</ul>
			<h4>Administration</h4>
			<p>Pragmatach has a built in web administration console, just browse to the context path</p>

			<pre>
/pragmatach/admin
</pre>

			<p>in your application.</p>

			<p>On localhost, the link is:</p>

			<pre>
http://localhost:8080/pragmatach/admin
</pre>
			<p>In order for your project to use the Admin plugin, it must include the "pragmatach-adminapp" dependency.</p>

			<h4>Configuration</h4>
			<p>Configuration for the Pragmatach framework is contained in the file</p>
			<pre>
src\main\resources\pragmatach.configuration
</pre>
			<h4>Request Routing</h4>


			<p>Pragmatch uses REST-like route mapping. Request routes are declared via the @Route annotation, in conjunction with the signature of the annotated method</p>

			<p>In this example, the method "render()" will be called for the context path "/".</p>

			<pre>
<code>
@Route(uri = "/")
public Response render() throws PragmatachException
</code>
</pre>
			<p>In this example the method "myMethod(int)" will be called with the value "2" for the context path "/mycontroller/2".</p>

			<pre>
<code>
@Route(uri = "/mycontroller")
public Response render(int myValue) throws PragmatachException
</code>
</pre>
			<p>In order to bind parameters, both the @Route annotation and the @RouteParameter must be used. The @Route annotation is used to specify parameters passed in the URI, and the @RouteParametere is used to map those parameters to Java method parameters. For example:</p>

			<pre>
<code>
@Route(uri = "/user/@id")
public Response render(@RouteParameter(name="id") String userId) throws PragmatachException
</code>
</pre>
			<p>Regular Expressions can be specified for any parameter using @RouteParameter, for example:</p>

			<pre>
<code>
@Route(uri = "/user/@id")
public Response render(@RouteParameter(name="id", regex="\b\d+\b") int userId) throws PragmatachException
</code>
</pre>

			<p>Wildcard routes</p>

			<pre>
<code>
@Route(uri = "/user/*")
public Response render(String[] parameters) throws PragmatachException
</code>
</pre>

			<h4>Controller Scope</h4>
			<p>By default, all Controllers are Request scoped. However, Controllers can be declared as Session Scoped:</p>

			<pre>
<code>
@Controller(name="myController", scope = Controller.Scope.session)
</code>
</pre>
			<h4>Template Variables</h4>
			<p>The following variables are available in the templating engines (Velocity and Freemarker)</p>

			<ul>
				<li>session - The HttpSession.</li>
				<li>controller - The current Controller</li>
				<li>i8n - The i8n resolver</li>
				<li>The name of the current controller as specified in the @Controller annotation</li>
				<li>The names of all Session-scoped controllers as specified in their @Controller annotation</li>
			</ul>
			<p>So, to access the session in FreeMarker:</p>

			<pre>
<code>
${session}
</code>
</pre>

			<p>or to access the current Controller in Velocity</p>
			<pre>
<code>
$controller
</code>
</pre>
			<p>To access the Session-scoped controller declared with @Controller(name="userController", scope = Controller.Scope.session) in FreeMarker:</p>
			<pre>
<code>
${userController}
</code>
</pre>


			<h4>Static Resources</h4>
			<p>In order to differentiate static resources from Pragmatach pages, static resources are served from under the context path /public.</p>

			<h4>Cache Control</h4>
			<p>Cache control headers are specfied via the @CacheControl annotation on controllers. For example:</p>

			<pre>
<code>
@Controller(name = "IndexController")
@View(view = "index.ftl")
@CacheControl(maxAge = 10)
public class IndexController extends FreemarkerController
</code>
</pre>

			<h4>Pragmatach Modules</h4>
			<p>Pragmatach features such as Velocity support, the Admin console and Gson are added to the project by including maven modules. Modules can include both Controllers and resources.</p>


			<h4>An example FreeMarker Controller</h4>

			<pre>
<code>
package com.teverett.com.pragmatach.exampleproject;

import com.teverett.pragmatach.framework.annotation.Controller;
import com.teverett.pragmatach.framework.annotation.View;
import com.teverett.pragmatach.framework.annotation.Route;
import com.teverett.pragmatach.framework.api.PragmatachException;
import com.teverett.pragmatach.framework.api.Response;
import com.teverett.pragmatach.plugin.freemarker.FreemarkerController;

@Controller(name="indexController")
@View(view = "index.html")
public class IndexController extends FreemarkerController {
   @Route(uri = "/")
   public Response render() throws PragmatachException {
      return super.render();
   }
}
</code>
</pre>

			<h4>An example FreeMarker Template</h4>
			<pre>
<code>
&lt;!DOCTYPE html>
&lt;head>
   &lt;title>exampleproject&lt;/title>
&lt;/head>
&lt;body>
&lt;h1>exampleproject&lt;/h1>
    &lt;img src="/public/logo.png">
    ${indexController.message}
    &lt;h2>Current Time&lt;/h2>
    ${indexController.time}
&lt;/body>
</code>
</pre>


			<h4>An example Gson Controller</h4>
			<pre>
<code>
package com.teverett.com.pragmatach.examples.gsonexample;

import java.util.Date;

import com.teverett.pragmatach.framework.annotation.Controller;
import com.teverett.pragmatach.framework.annotation.Route;
import com.teverett.pragmatach.framework.api.PragmatachException;
import com.teverett.pragmatach.framework.api.Response;
import com.teverett.pragmatach.plugin.gson.GSONController;

@Controller(name="index")
public class IndexController extends GSONController {
   /**
    * the message
    */
   private final String message = "hello world";
   /**
    * the time
    */
   private String time;

   public String getMessage() {
      return message;
   }

   public String getTime() {
      return time;
   }

   @Route(uri = "/")
   public Response render() throws PragmatachException {
      time = new Date().toString();
      return super.render();
   }

   public void setTime(String time) {
      this.time = time;
   }
}
</code>
</pre>
			<p>The output produced is</p>

			<pre>
<code>
{"message":"hello world","time":"Sun Feb 17 14:28:34 MST 2013"}
</code>
</pre>

			<h4>An example Velocity Controller</h4>
			<pre>
<code>
package com.teverett.com.pragmatach.exampleproject;

import com.teverett.pragmatach.framework.annotation.Controller;
import com.teverett.pragmatach.framework.annotation.View;
import com.teverett.pragmatach.framework.annotation.Route;
import com.teverett.pragmatach.framework.api.PragmatachException;
import com.teverett.pragmatach.framework.api.Response;
import com.teverett.pragmatach.plugin.velocity.VelocityController;

@Controller(name="index")
@View(view="index.ftl")
public class IndexController extends VelocityController {   
   @Route(uri = "/")
   public Response render(Request request) throws PragmatachException {
      return super.render(request);
   }
}
</code>
</pre>

			<h4>Population of Controller fields via HTML Form POST</h4>


			<p>A typical HTML Form:</p>
			<pre>
<code>
&lt;form action="/showfeed" method="post" enctype="multipart/form-data">
    &lt;input name="feedURL" type="text">
    &lt;button type="submit" class="btn">Submit&lt;button>
&lt;/form>
</code>
			</pre>
			<p>When the form is posted to a controller route of type "HttpMethod.post" the Controller field "feedURL" will be automatically populated</p>

			<pre>
<code>
@Controller(name="index")
@View(view = "acceptPost.html")
public class AcceptPostController extends FreemarkerController {
   /**
    * the URL
    */
   private String feedURL;

   public String getFeedURL() {
      return feedURL;
   }

   public void setFeedURL(String feedURL) {
      this.feedURL = feedURL;
   }

   @Route(uri = "/acceptpost", method = HttpMethod.post)
   public Response acceptpost() throws PragmatachException {
      try {
         if (null != feedURL) {
     
         }
         /*
          * render
          */
         return super.render();
      } catch (final Exception e) {
         throw new PragmatachException("Exception in showFeed", e);
      }
   }
}
</code>
</pre>

			<h4>Population of Controller fields via JSON Form POST</h4>

			<p>The JSONController is capable of accepting JSON POSTs and populating atomic controllers fields automatically. For example posting this:</p>

			<pre>
<code>
{"message":"hello world"}
</code>
</pre>

			<p>To this controller:</p>
			<pre>
<code>
@Controller(name="index")
@View(view = "acceptPost.html")
public class AcceptPostController extends JSONController {
   /**
    * message
    */
   private String message;

   public String getMessage() {
      return message;
   }

   public void setMessage(String message) {
      this.message = message;
   }

   @Route(uri = "/acceptpost", method = HttpMethod.post)
   public Response acceptJSONpost() throws PragmatachException {
         return super.render();
      } catch (final Exception e) {
         throw new PragmatachException("Exception in showFeed", e);
      }
   }
}
</code>
</pre>
			<p>Will result in the method setMessage() being called with the value "hello world".</p>

			<h4>Cookie Encryption</h4>
			<p>Pragmatach supports cookie encryption with AES. Cookie encryption is supported by setting the crypto key as the pragmatach.properties file value pragmatach.cookie.cryptokey.</p>


			<h4>Pragmatach custom HTTP headers</h4>
			<p>Pragmatach responses return the custom header X-Pragmatach-RenderTime containing the request render time, in milliseconds.</p>

			<h4>JMX Bindings</h4>
			<p>In order to support runtime inspection of applications, Pragmatach supports JMX bindings using MXBeans.</p>

			<h4>JCR Support</h4>
			<p>Support for the JCR is provided via the "pragmatach-jcr" plugin. This plugin will accept a HTTP GET with an encoded JCR Node path and will return JSON containing the names-value pairs for every JCR Property in that Node.</p>

			<p>The below code binds the route /example/@propertyName and returns JSON for the properties of the node path passed as "propertyName".</p>

			<pre>
<code>
@Controller(name = "ExampleJCRController")
public class ExampleJCRController extends JCRController {
   @Route(uri = "example/@propertyName")
   public Response render(@RouteParameter(name = "propertyName") String propertyName) throws PragmatachException {
      return super.render(propertyName);
   }
}
</code>
</pre>

			<p>An example link to this route is.</p>

			<pre>
<code>
&lt;a href="${session.getServletContext().getContextPath()}/example/hello%2Fworld">Example Route Binding 1&lt;/a>
</code>
</pre>

			<p>This example link is querying the JCR for the properties of the Node "hello/world"</p>

			<h4>i8n support</h4>
			<p>I8N support is provided by Pragmatach plugins which expose implementation of I8NProvider to Pragmatach. The variable i8n is then available in template engines to use for internationalization. The plugin pragmatach-i8n provides simple internationalization of strings and dates.</p>

			<p>An example i8n file, used by pragmatach-i8n for the locale en_us would have the name i8n.properties_en_us. The contents of the example are:</p>
			<pre>
<code>
admin=Administration
home=Home
rssviewer=RSS Viewer
</code>
</pre>

			<p>An example of using this localization data from a Freemarker template is:</p>

			<pre>
<code>
&lt;a class="brand" href="#">${i8n.text("en_us","rssviewer")}&lt;/a>
</code>
</pre>

			<p>which generates this HTML:</p>
			<pre>
<code>
&lt;a class="brand" href="#">RSS Viewer&lt;/a>
</code>
</pre>



		</section>
	#include( "src/main/site/footer.tpl" )
	</div>
	<script src="javascripts/scale.fix.js"></script>
</body>
</html>